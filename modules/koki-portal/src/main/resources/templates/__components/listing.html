<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<body>

<div class="widget" th:fragment="listing-breadcrumb(listing)">
    <div class="widget-body">
        <nav aria-label="breadcrumb" style="--bs-breadcrumb-divider: '>';">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/" th:text="#{module.home}">HOME</a></li>
                <li class="breadcrumb-item" th:if="${listing}"><a href="/listings"
                                                                  th:text="#{module.listing}">LISTING</a></li>
                <li class="breadcrumb-item active" th:if="${listing}">
                    <span th:text="${listing.listingNumber}">NUMBER</span>
                </li>
                <li class="breadcrumb-item active" th:if="!${listing}" th:text="#{module.listing}">Accounts</li>
            </ol>
        </nav>
    </div>
</div>

<div th:fragment="listing-status-badge(status)" th:remove="tag">
    <span class="badge text-bg-secondary"
          th:if="${status.name() == 'DRAFT'}"
          th:text="#{'listing-status.' + ${status}}">A LOUER</span>

    <span class="badge text-bg-warning" th:if="${status.name() == 'PUBLISHING'}"
          th:text="#{'listing-status.' + ${status}}">PUBLISHING</span>

    <span class="badge text-bg-primary"
          th:if="${status.name() == 'ACTIVE'} OR ${status.name() == 'ACTIVE_WITH_OFFER'} OR ${status.name() == 'PENDING'}"
          th:text="#{'listing-status.' + ${status}}">A LOUER</span>

    <span class="badge text-bg-success" th:if="${status.name() == 'RENTED'} OR ${status.name() == 'SOLD'}"
          th:text="#{'listing-status.' + ${status}}">A LOUER</span>

    <span class="badge text-bg-danger"
          th:if="${status == 'EXPIRED'} OR ${status.name() == 'WITHDRAWN'} OR ${status.name() == 'CANCELLED'}"
          th:text="#{'listing-status.' + ${status}}">A LOUER</span>
</div>

<div th:fragment="listing-type-badge(type)" th:remove="tag">
    <span class="badge text-bg-info margin-right" th:text="#{'listing-type.' + ${type}}">A LOUER</span>
</div>

<div th:fragment="listing-table(items, sold)" th:if="!${items.isEmpty()}">
    <table class="table">
        <tr class="d-none d-md-table-row">
            <th colspan="2" th:text="#{page.listing.address}" width="40%">ADDRESS</th>

            <th th:if="${sold}" th:text="#{page.listing.agent}">AGENT</th>
            <th th:if="${sold}" th:text="#{page.listing.transaction-date}">DATE</th>
            <th class="text-right" th:if="${sold}" th:text="#{page.listing.transaction-price}">PRICE</th>

            <th th:if="!${sold}" th:text="#{page.listing.description}" width="20%">DESCRIPTION</th>
            <th class="text-right" th:if="!${sold}" th:text="#{page.listing.price}">PRICE</th>
        </tr>
        <tr class="listing" th:each="listing : ${items}">
            <div th:replace="~{__components/listing :: listing-row(${listing}, ${sold})}"></div>
        </tr>
    </table>
</div>

<tr th:fragment="listing-row(listing, sold)" th:remove="tag">
    <td width="1%">
        <div class="hero-image text-center">
            <a th:href="'/listings/' + ${listing.id}">
                <img th:if="${listing.heroImageUrl}" th:src="${listing.heroImageUrl}"/>
            </a>
        </div>
    </td>
    <td>
        <a th:href="'/listings/' + ${listing.id}">
            <div th:utext="${listing.address?.toHtml(false)}">ADDRESS</div>

            <div th:if="!${listing.statusActive} AND !${sold}">
                <div th:replace="~{__components/listing :: listing-status-badge(${listing.status})}"></div>
            </div>

            <table border="0" class="d-block d-md-none margin-top-small text-small">
                <tr th:if="!${sold}">
                    <th th:text="#{page.listing.description}">DESC</th>
                    <td class="padding-left">
                        <div th:replace="~{__components/listing :: listing-bed-bath-area(${listing})}"></div>
                    </td>
                </tr>
                <tr th:if="!${sold} AND ${listing.price}">
                    <th th:text="#{page.listing.price}">PRICE</th>
                    <td class="padding-left" th:text="${listing.price.displayText}">$$$</td>
                </tr>

                <tr th:if="${sold} AND (${listing.sellerAgentUser} OR ${listing.buyerAgentUser})">
                    <th th:text="#{page.listing.agent}">AGENT</th>
                    <td class="padding-left">
                        <span th:if="${listing.isSeller(user)}" th:text="#{page.listing.agent-seller}">SELLER</span>
                        <span th:if="${listing.isBuyer(user)}" th:text="#{page.listing.agent-buyer}">BUYER</span>
                    </td>
                </tr>
                <tr th:if="${sold} AND ${listing.transactionDate}">
                    <th th:text="#{page.listing.transaction-date}">DATE</th>
                    <td class="padding-left" th:text="${listing.transactionDateText}">$$$</td>
                </tr>
                <tr th:if="${sold} AND ${listing.transactionPrice}">
                    <th th:text="#{page.listing.transaction-price}">PRICE</th>
                    <td class="padding-left" th:text="${listing.transactionPrice.displayText}">$$$</td>
                </tr>
            </table>
        </a>
    </td>

    <td class="d-none d-md-table-cell" th:if="${sold}">
        <a th:href="'/listings/' + ${listing.id}" th:if="${listing.sellerAgentUser} OR ${listing.buyerAgentUser}">
            <span th:if="${listing.isSeller(user)}" th:text="#{page.listing.agent-seller}">SELLER</span>
            <span th:if="${listing.isBuyer(user)}" th:text="#{page.listing.agent-buyer}">BUYER</span>
        </a>
    </td>
    <td class="d-none d-md-table-cell" th:if="${sold}">
        <a th:href="'/listings/' + ${listing.id}" th:text="${listing.transactionDateText}">YYYY-MM-DD</a>
    </td>
    <td class="text-right text-nowrap d-none d-md-table-cell" th:if="${sold}">
        <a th:href="'/listings/' + ${listing.id}" th:if="${listing.transactionPrice}">
            <div class="text-nowrap listing-price">
                <span th:text="${listing.transactionPrice.displayText}">$$</span>
            </div>
        </a>
    </td>

    <td class="d-none d-md-table-cell" th:if="!${sold}">
        <a th:href="'/listings/' + ${listing.id}">
            <div th:replace="~{__components/listing :: listing-bed-bath-area(${listing})}"></div>
        </a>
    </td>
    <td class="text-right text-nowrap d-none d-md-table-cell" th:if="!${sold}">
        <a th:href="'/listings/' + ${listing.id}" th:if="${listing.price}">
            <div class="text-nowrap listing-price">
                <span th:text="${listing.price.displayText}">$$</span>
            </div>
        </a>
    </td>
</tr>

<div class="flex" th:fragment="listing-bed-bath-area(listing)">
    <div class="margin-right-small"
         th:if="${listing.bedrooms}"
         th:text="${listing.bedrooms} + #{page.listing.bedrooms-abbreviation}">
        00
    </div>
    <div class="margin-right-small"
         th:if="${listing.bathrooms}"
         th:text="${listing.bathrooms} + #{page.listing.bathrooms-abbreviation}">
        00
    </div>
    <div th:if="${listing.lotArea} OR ${listing.propertyArea}">
        <span th:if="${listing.lotArea}" th:text="${listing.lotArea}">00</span>
        <span th:if="!${listing.lotArea}" th:text="${listing.propertyArea}">00</span>
        m<sup>2</sup>
    </div>
</div>

<div th:fragment="listing-summary(listing)" th:remove="tag">
    <div>
        <span th:replace="~{__components/listing :: listing-type-badge(${listing.listingType})}"></span>
        <span th:replace="~{__components/listing :: listing-status-badge(${listing.status})}"></span>
    </div>
    <div class="margin-top-small">
        <h1 class="margin-none listing-price" th:if="${listing.price}">
            <span th:text="${listing.price.displayText}">0000</span>
        </h1>

        <div class="margin-top-small">
            <span th:text="#{'property-type.' + ${listing.propertyType}}">PROPERTY_TYPE</span>
            <span th:if="${listing.furnitureType}">-</span>
            <span th:if="${listing.furnitureType}"
                  th:text="#{'furniture-type.' + ${listing.furnitureType}}">
                FURNITURE_TYPE
            </span>
        </div>
        <div class="text-larger" th:if="${listing.address}" th:utext="${listing.address.toHtml(false)}">
            ADDRESS
        </div>
        <div class="text-small margin-top-small">
            <span th:text="#{page.listing.number}">#</span>:
            <span th:text="${listing.listingNumber}">00000</span>
        </div>
        <div class="margin-top-small">
            <div class="float-right">
                <div class="flex">
                    <div class="text-center" th:if="${listing.bedrooms}">
                        <b th:text="${listing.bedrooms}">00</b>
                        <div class="text-small" th:text="#{page.listing.bedrooms}">BEDROOMS</div>
                    </div>
                    <div class="text-center margin-left" th:if="${listing.bathrooms}">
                        <b th:text="${listing.bathrooms}">00</b>
                        <div class="text-small" th:text="#{page.listing.bathrooms}">BATHROOMS</div>
                    </div>
                    <div class="text-center margin-left"
                         th:if="${listing.lotArea} OR ${listing.propertyArea}">
                        <b th:if="${listing.propertyArea}" th:text="${listing.propertyArea}">00</b>
                        <b th:if="${listing.lotArea} AND !${listing.propertyArea}"
                           th:text="${listing.lotArea}">
                            00
                        </b>
                        <div class="text-small">m<sup>2</sup></div>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>

<div class="listing-card" th:data-id="${listing.id}" th:fragment="listing-card(listing)">
    <div class="hero-image-container">
        <a target="_new" th:href="'/listings/' + ${listing.id}">
            <img class="hero-image" th:src="${listing.heroImageUrl}"/>
        </a>
    </div>
    <div class="listing-details padding-small">
        <a target="_new" th:href="'/listings/' + ${listing.id}">
            <b class="listing-price" th:text="${listing.price.displayText}">$$$</b>
            <div class="text-small">
                <div th:replace="~{__components/listing :: listing-bed-bath-area(${listing})}"></div>
            </div>
            <div class="text-small" th:if="${listing.address}">
                <span th:text="${listing.address?.neighbourhood?.name}">XXX</span>
                <span>-</span>
                <span th:text="${listing.address?.city?.name}">XXX</span>
            </div>
            <div class="margin-top-small flex" th:if="${listing.sellerAgentUser}">
                <img height="64"
                     th:src="${listing.sellerAgentUser.photoUrl} ? ${listing.sellerAgentUser.photoUrl}: '/image/no-photo.png'"
                     width="64"/>
                <div class="margin-left-small text-small">
                    <div th:text="${listing.sellerAgentUser?.displayName}">AGENT</div>
                    <div th:text="${listing.sellerAgentUser?.employer}">AGENT</div>
                    <div th:if="!${listing.statusSold}">
                        <i class="fa-solid fa-coins"></i>
                        <span class="listing-price" th:text="${listing.computeAgentCommission(user)}">XXX</span>
                    </div>
                </div>
            </div>
        </a>
    </div>
</div>

<div class="listing-filter-container" th:fragment="listing-filters(form, locations)">
    <!-- Listing Type -->
    <div class="listing-filter">
        <span th:if="${form.listingType == 'SALE'}" th:text="#{listing-type.SALE}">TYPE</span>
        <span th:if="${form.listingType == 'RENTAL'}" th:text="#{listing-type.RENTAL}">TYPE</span>
        <span th:if="${form.listingType == 'SOLD'}" th:text="#{listing-status.SOLD}">TYPE</span>
    </div>

    <!-- Location -->
    <div class="listing-filter" th:if="${locations}">
        <span class="listing-filter-badge" th:each="location : ${locations}" th:text="${location.name}">LOCATION</span>
    </div>

    <!-- Rooms -->
    <div class="listing-filter" th:if="${form.bedrooms?.length() > 0}">
        <b th:text="#{page.listing.bedrooms-short} + ':'">BEDROOM</b>
        <span th:text="${form.bedrooms}">00</span>
    </div>
    <div class="listing-filter" th:if="${form.bathrooms?.length() > 0}">
        <b th:text="#{page.listing.bathrooms-short} + ':'">BATHROOM</b>
        <span th:text="${form.bathrooms}">00</span>
    </div>

    <!-- Property Types -->
    <div class="listing-filter" th:if="!${form.propertyTypes.isEmpty()}">
        <span class="listing-filter-badge"
              th:each="propertyType : ${form.propertyTypes}"
              th:text="#{'property-type.' + ${propertyType}}">
            TYPE
        </span>
    </div>

    <!-- Price -->
    <div class="listing-filter" th:if="${form.minPrice} OR ${form.maxPrice}">
        <b th:text="#{page.listing.price-short} + ':'">PRICE</b>
        <div th:if="${form.minPrice} AND ${form.maxPrice}" th:remove="tag">
            <span th:text="${form.minPriceText}">$$</span>
            -
            <span th:text="${form.maxPriceText}">$$</span>
        </div>
        <div th:if="!${form.maxPrice}" th:remove="tag">
            <span th:text="${form.minPriceText} + '+'">$$</span>
        </div>
        <div th:if="!${form.minPrice}" th:remove="tag">
            <span th:text="#{page.listing.list.up-to}">UP_TO</span>
            <span th:text="${form.maxPriceText}">$$</span>
        </div>
    </div>

    <!-- Lot -->
    <div class="listing-filter" th:if="${form.minLotArea} OR ${form.maxLotArea}">
        <b th:text="#{page.listing.lot} + ':'">PRICE</b>
        <div th:if="${form.minLotArea} AND ${form.maxLotArea}" th:remove="tag">
            <span th:text="${form.minLotAreaText}">$$</span>
            -
            <span th:text="${form.maxLotAreaText}">$$</span>
            <span>m<sup>2</sup></span>
        </div>
        <div th:if="!${form.maxLotArea}" th:remove="tag">
            <span th:text="${form.minLotAreaText} + '+'">$$</span>
            <span>m<sup>2</sup></span>
        </div>
        <div th:if="!${form.minLotArea}" th:remove="tag">
            <span th:text="#{page.listing.list.up-to}">UP_TO</span>
            <span th:text="${form.maxPriceText}">$$</span>
            <span>m<sup>2</sup></span>
        </div>
    </div>

    <!-- Property -->
    <div class="listing-filter" th:if="${form.minPropertyArea} OR ${form.maxPropertyArea}">
        <b th:text="#{page.listing.lot} + ':'">PRICE</b>
        <div th:if="${form.minPropertyArea} AND ${form.maxPropertyArea}" th:remove="tag">
            <span th:text="${form.minPropertyAreaText}">$$</span>
            -
            <span th:text="${form.maxPropertyAreaText}">$$</span>
            <span>m<sup>2</sup></span>
        </div>
        <div th:if="!${form.maxPropertyArea}" th:remove="tag">
            <span th:text="${form.minPropertyAreaText} + '+'">$$</span>
            <span>m<sup>2</sup></span>
        </div>
        <div th:if="!${form.minPropertyArea}" th:remove="tag">
            <span th:text="#{page.listing.list.up-to}">UP_TO</span>
            <span th:text="${form.maxPriceText}">$$</span>
            <span>m<sup>2</sup></span>
        </div>
    </div>
</div>

</body>
</html>
