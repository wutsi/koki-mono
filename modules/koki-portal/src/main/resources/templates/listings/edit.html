<!DOCTYPE HTML>
<html th:lang="${page.language}" xmlns:th="https://www.thymeleaf.org">
<head>
    <div th:replace="~{__components/layout :: head}"></div>
</head>

<body>
<div th:replace="~{__components/layout :: navbar}"></div>
<div th:replace="~{__components/layout :: menubar('listing')}"></div>

<div class="container">
    <div class="row">
        <div class="col-12">
            <div th:replace="~{__components/listing :: listing-breadcrumb(${listing})}"></div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <form class="form" method="post" th:action="@{/listings/edit}" th:object="${form}">
                <input th:field="*{id}" type="hidden"/>
                <div class="form-body">
                    <div class="section">
                        <div class="section-body">
                            <div class="section-item">
                                <h2 class="margin-none" th:text="#{page.listing.edit.title}">TITLE</h2>
                            </div>
                            <div class="section-item">
                                <label class="title" th:text="#{page.listing.listing-type}">TYPE</label>
                                <select class="form-select" th:field="*{listingType}">
                                    <option th:each="listingType : ${listingTypes}"
                                            th:if="${listingType.name() != 'UNKNOWN'}"
                                            th:text="#{'listing-type.' + ${listingType}}"
                                            th:value="${listingType}">
                                        TYPE
                                    </option>
                                </select>
                            </div>
                            <div class="section-item">
                                <label class="title" th:text="#{page.listing.property-type}">TYPE</label>
                                <select class="form-select" th:field="*{propertyType}">
                                    <option th:each="propertyType : ${propertyTypes}"
                                            th:if="${propertyType.name() != 'UNKNOWN'}"
                                            th:text="#{'property-type.' + ${propertyType}}"
                                            th:value="${propertyType}">
                                        TYPE
                                    </option>
                                </select>
                            </div>
                            <div class="section-item" data-property-type-commercial>
                                <label class="title" th:text="#{page.listing.units}">UNITS</label>
                                <input class="form-control" step="0" th:field="*{units}" type="number"/>
                            </div>
                            <div class="section-item" data-property-type-residential>
                                <label class="title" th:text="#{page.listing.bedrooms}">BEDROOMS</label>
                                <input class="form-control" step="0" th:field="*{bedrooms}" type="number"/>
                            </div>
                            <div class="section-item" data-property-type-residential>
                                <label class="title" th:text="#{page.listing.bathrooms}">BATHROOMS</label>
                                <input class="form-control" step="0" th:field="*{bathrooms}" type="number"/>
                            </div>
                            <div class="section-item" data-property-type-residential>
                                <label class="title" th:text="#{page.listing.half-bathrooms}">TOILET</label>
                                <input class="form-control" step="0" th:field="*{halfBathrooms}" type="number"/>
                            </div>
                            <div class="section-item">
                                <label class="title" th:text="#{page.listing.lot-area}">TYPE</label>
                                <div class="input-group">
                                    <input class="form-control" step="0" th:field="*{lotArea}" type="number"/>
                                    <div class="input-group-append">
                                        <div class="input-group-text">
                                            <span>m<sup>2</sup></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="section-item" data-property-type-commercial data-property-type-residential>
                                <label class="title" th:text="#{page.listing.property-area}">TYPE</label>
                                <div class="input-group">
                                    <input class="form-control" step="0" th:field="*{propertyArea}" type="number"/>
                                    <div class="input-group-append">
                                        <div class="input-group-text">
                                            <span>m<sup>2</sup></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="section-item" data-property-type-commercial data-property-type-residential>
                                <label class="title" th:text="#{page.listing.floors}">FLOORS</label>
                                <input class="form-control" step="0" th:field="*{floors}" type="number"/>
                            </div>
                            <div class="section-item" data-property-type-commercial data-property-type-residential>
                                <label class="title" th:text="#{page.listing.level}">TYPE</label>
                                <select class="form-select" th:field="*{level}">
                                    <option value=""></option>
                                    <option th:each="level,it : ${levels}"
                                            th:text="${levelTexts.get(it.index)}"
                                            th:value="${level}">
                                        LEVEL
                                    </option>
                                </select>
                            </div>
                            <div class="section-item" data-property-type-commercial data-property-type-residential>
                                <label class="title" th:text="#{page.listing.parkings}">PARKINGS</label>
                                <input class="form-control" step="0" th:field="*{parkings}" type="number"/>
                            </div>
                            <div class="section-item" data-property-type-commercial data-property-type-residential>
                                <label class="title" th:text="#{page.listing.parking-type}">TYPE</label>
                                <select class="form-select" th:field="*{parkingType}">
                                    <option th:each="parkingType : ${parkingTypes}"
                                            th:text="#{'parking-type.' + ${parkingType}}"
                                            th:value="${parkingType}">
                                        TYPE
                                    </option>
                                </select>
                            </div>
                            <div class="section-item">
                                <label class="title" th:text="#{page.listing.fence}">TYPE</label>
                                <select class="form-select" th:field="*{fenceType}">
                                    <option th:each="fenceType : ${fenceTypes}"
                                            th:text="#{'fence-type.' + ${fenceType}}"
                                            th:value="${fenceType}">
                                        TYPE
                                    </option>
                                </select>
                            </div>
                            <div class="section-item" data-property-type-commercial data-property-type-residential>
                                <label class="title" th:text="#{page.listing.basement}">TYPE</label>
                                <select class="form-select" th:field="*{basementType}">
                                    <option th:each="basementType : ${basementTypes}"
                                            th:text="#{'basement-type.' + ${basementType}}"
                                            th:value="${basementType}">
                                        TYPE
                                    </option>
                                </select>
                            </div>
                            <div class="section-item">
                                <label class="title" th:text="#{page.listing.distance-from-main-road}">TYPE</label>
                                <div class="input-group">
                                    <input class="form-control" step="0" th:field="*{distanceFromMainRoad}"
                                           type="number"/>
                                    <div class="input-group-append">
                                        <div class="input-group-text">
                                            <span>m</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="section-item">
                                <label class="title" th:text="#{page.listing.road-pavement}">TYPE</label>
                                <select class="form-select" th:field="*{roadPavement}">
                                    <option th:each="roadPavement : ${roadPavements}"
                                            th:text="#{'road-pavement.' + ${roadPavement}}"
                                            th:value="${roadPavement}">
                                        TYPE
                                    </option>
                                </select>
                            </div>
                            <div class="section-item">
                                <label class="title" th:text="#{page.listing.available-at}">YEAR</label>
                                <input class="form-control" th:field="*{availableAt}" type="date"/>
                            </div>
                            <div class="section-item" data-property-type-commercial data-property-type-residential>
                                <label class="title" th:text="#{page.listing.year}">YEAR</label>
                                <input class="form-control" step="0" th:field="*{year}" type="number"/>
                            </div>

                            <div class="section-item">
                                <button class="btn btn-primary w-49-mobile" th:text="#{button.submit}" type="submit">
                                    SUBMIT
                                </button>
                                <a class="btn btn-light w-49-mobile" onclick="history.back()"
                                   th:text="#{button.cancel}">
                                    CANCEL
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

    </div>
</div>

<script>
    function property_type_changed() {
        console.log('property_type_changed');

        const propertyType = document.querySelector('#propertyType').value;
        const propertyTypeCommercial = (propertyType === 'BUILDING' || propertyType === 'COMMERCIAL' || propertyType === 'INDUSTRIAL');
        const propertyTypeLand = (propertyType === 'LAND');
        const propertyTypeResidential = (!propertyTypeLand && !propertyTypeCommercial);

        document.querySelectorAll('.section-item').forEach(function (div) {
            if (div.hasAttribute('data-property-type-commercial') || div.hasAttribute('data-property-type-land') || div.hasAttribute('data-property-type-residential')) {
                console.log('>>> found', div);
                var show = false;
                if (div.hasAttribute('data-property-type-commercial')) {
                    show |= propertyTypeCommercial;
                }
                if (div.hasAttribute('data-property-type-land')) {
                    show |= propertyTypeLand;
                }
                if (div.hasAttribute('data-property-type-residential')) {
                    show |= propertyTypeResidential;
                }
                div.style.display = show ? 'block' : 'none';

                div.querySelectorAll('input, select').forEach(function (element) {
                    element.disabled = !show;
                });
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        property_type_changed();
        document.querySelector('#propertyType').addEventListener('change', property_type_changed);
    });
</script>
</body>
</html>
