<!DOCTYPE HTML>
<html th:lang="${page.language}" xmlns:th="https://www.thymeleaf.org">
<head>
    <div th:replace="~{__components/layout :: head}"></div>
</head>

<body>
<div th:replace="~{__components/layout :: navbar}"></div>

<div class="agent-info-container">
    <div class="agent-info-details">
        <div class="margin-top">&nbsp;</div>

        <!-- PICTURE -->
        <div>
            <h1 th:text="${neighbourhood.name}">NAME</h1>
            <div class="text-larger"
                 th:text="#{page.neighbourhood.sub_title(${neighbourhood.name},${city?.name})}">
                DESCRIPTION
            </div>
        </div>

        <!-- METRICS -->
        <div class="margin-top" id="metric-container"
             th:if="${overallSalesMetrics} OR ${overallRentalMetrics} OR ${landMetrics}">
            <hr/>
            <div
                th:replace="~{__components/listing :: listing-price-metrics(${overallSalesMetrics}, ${overallRentalMetrics}, ${landMetrics})}"></div>
        </div>

        <!-- SUMMARY -->
        <div class="margin-top" id="introduction-container" th:if="${place?.introduction}">
            <hr/>
            <div th:utext="${place.introductionHtml}">INTRODUCTION</div>

            <div class="margin-top-2x" id="rating-container" th:if="${place.rating}">
                <div th:replace="~{__components/place :: place-rating(${place}, true)}"></div>
            </div>
        </div>

        <!-- AGENTS -->
        <div class="margin-top" id="agent-container" th:if="${agents}">
            <hr/>
            <h2 th:text="#{page.neighbourhood.section.agents(${neighbourhood.name})}">TITLE</h2>
            <div class="row">
                <div class="col-12 col-md-6 agent" th:each="agent : ${agents}">
                    <div th:replace="~{__components/agent :: agent-card(${agent})}"></div>
                </div>
            </div>
        </div>

        <!-- ACTIVE LISTINGS -->
        <div class="margin-top" id="rental-listing-container" th:if="${rentalListings}">
            <hr/>
            <h2 th:text="#{page.neighbourhood.section.for_rent(${neighbourhood.name})}">TITLE</h2>
            <div th:replace="~{__components/listing :: listing-carousel(${rentalListings}, true)}"></div>
        </div>
        <div class="margin-top" id="sale-listing-container" th:if="${saleListings}">
            <hr/>
            <h2 th:text="#{page.neighbourhood.section.for_sale(${neighbourhood.name})}">TITLE</h2>
            <div th:replace="~{__components/listing :: listing-carousel(${saleListings}, true)}"></div>
        </div>

        <!-- SOLD -->
        <div class="margin-top" id="sold-listing-container" th:if="${soldListings}">
            <hr/>
            <h2 th:text="#{page.neighbourhood.section.sold(${neighbourhood.name})}">TITLE</h2>
            <div class="margin-bottom" id="map-container">
                <div data-component-id="map"
                     data-disable-scroll-wheel-zoom="true"
                     id="map"
                     th:data-latitude="${mapCenterPoint?.latitude}"
                     th:data-longitude="${mapCenterPoint?.longitude}"
                     th:data-on-ready="on_map_ready"
                     th:data-show-marker="${mapCenterPoint} ? true : false"
                     th:data-zoom="14"
                >
                </div>
            </div>
            <div th:replace="~{__components/listing :: listing-carousel(${soldListings}, false)}"></div>
        </div>

        <!-- ABOUT -->
        <div class="margin-top" id="about-container" th:if="${place?.description}">
            <hr/>
            <h2 th:text="#{page.neighbourhood.section.about(${neighbourhood.name})}">TITLE</h2>
            <div th:utext="${place.descriptionHtml}">DESCRIPTION</div>

            <!-- SCHOOLS -->
            <div class="margin-top-2x" id="school-container" th:if="${schools}">
                <h3 th:text="#{page.neighbourhood.section.schools}">TITLE</h3>
                <table class="table table-striped">
                    <tr class="d-none d-md-table-row">
                        <th></th>
                        <th th:text="#{page.place.academic-systems}">System</th>
                        <th th:text="#{page.place.levels}">Level</th>
                        <th width="1%"></th>
                    </tr>
                    <tr th:each="school : ${schools}">
                        <td>
                            <div>
                                <a target="_blank" th:href="${school.websiteUrl}"
                                   th:if="${school.websiteUrl}"
                                   th:text="${school.name}">NAME</a>
                                <span th:if="!${school.websiteUrl}" th:text="${school.name}">NAME</span>
                            </div>
                            <table class="d-block d-md-none text-small margin-top-small">
                                <tr th:if="!${school.academicSystems.isEmpty()}">
                                    <th class="text-top" th:text="#{page.place.academic-systems}">System</th>
                                    <td class="padding-left" th:text="${school.academicSystemsText}">SYSTEM</td>
                                </tr>
                                <tr th:if="!${school.levels.isEmpty()}">
                                    <th th:text="#{page.place.levels}">System</th>
                                    <td class="padding-left" th:text="${school.levelsText}">SYSTEM</td>
                                </tr>
                            </table>
                        </td>
                        <td class="d-none d-md-table-cell" th:text="${school.academicSystemsText}">SYSTEM</td>
                        <td class="d-none d-md-table-cell" th:text="${school.levelsText}">LEVELS</td>
                        <td width="1%">
                            <span th:if="${school.private}" th:text="#{page.place.private}">PRIVATE</span>
                        </td>
                    </tr>
                </table>
            </div>

            <!-- HOSPITAL -->
            <div class="margin-top-2x" id="hospital-container" th:if="${hospitals}">
                <h3 th:text="#{page.neighbourhood.section.hospitals}">TITLE</h3>
                <table class="table table-striped">
                    <tr th:each="hospital : ${hospitals}">
                        <td>
                            <a target="_blank" th:href="${hospital.websiteUrl}"
                               th:if="${hospital.websiteUrl}"
                               th:text="${hospital.name}">NAME</a>
                            <span th:if="!${hospital.websiteUrl}" th:text="${hospital.name}">NAME</span>
                        </td>
                        <td width="1%">
                            <span th:if="${hospital.private}" th:text="#{page.place.private}">PRIVATE</span>
                        </td>
                    </tr>
                </table>
            </div>

            <!-- MARKETS -->
            <div class="margin-top-2x" id="market-container" th:if="${markets}">
                <h3 th:text="#{page.neighbourhood.section.markets}">TITLE</h3>
                <table class="table table-striped">
                    <tr th:each="market : ${markets}">
                        <td>
                            <a target="_blank" th:href="${market.websiteUrl}"
                               th:if="${market.websiteUrl}"
                               th:text="${market.name}">NAME</a>
                            <span th:if="!${market.websiteUrl}" th:text="${market.name}">NAME</span>
                        </td>
                        <td width="1%">
                        <span th:if="${market.type.name == 'SUPERMARKET'}" th:text="#{page.place.supermarket}">
                            SUPERMARKET
                        </span>
                        </td>
                    </tr>
                </table>
            </div>

            <!-- TODOS -->
            <div class="margin-top-2x" id="todo-container" th:if="${todos}">
                <h3 th:text="#{page.neighbourhood.section.todo}">TITLE</h3>
                <table class="table table-striped">
                    <tr th:each="todo : ${todos}">
                        <td>
                            <a target="_blank" th:href="${todo.websiteUrl}"
                               th:if="${todo.websiteUrl}"
                               th:text="${todo.name}">NAME</a>
                            <span th:if="!${todo.websiteUrl}" th:text="${todo.name}">NAME</span>
                        </td>
                    </tr>
                </table>
            </div>

            <!-- PRICE_TRENDS -->
            <div class="margin-top-2x" id="price-trend-container"
                 th:if="${salesMetrics} OR ${rentalMetrics} OR ${landMetrics}">
                <h3 th:text="#{page.neighbourhood.section.pricing}">Pricing Information</h3>

                <div
                    th:replace="~{__components/listing :: listing-price-trend(${salesMetrics}, ${rentalMetrics}, ${landMetrics})}"></div>
            </div>

            <!-- SIMILAR NEIGHBOURHOODS -->
            <div class="margin-top-2x" id="similar-neighbourhood-container" th:if="${similarNeighbourhoods}">
                <hr/>
                <h2 th:text="#{page.neighbourhood.section.similar_neighbourhoods(${city?.name})}">TITLE</h2>
                <div class="flex flex-wrap">
                    <div class="col-6 col-lg-4" th:each="neighbourhood:${similarNeighbourhoods}">
                        <a th:href="${neighbourhood.publicUrl}" th:text="${neighbourhood.name}">NAME</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CONTACT AGENT -->
    <div class="listing-contact-details" th:if="${topAgent}">
        <div class="listing-contact-details-inner">
            <div class="agent-info">
                <a th:href="${topAgent.publicUrl}" th:title="${topAgent.user.displayName}">
                    <img th:if="${topAgent.user.photoUrl}" th:src="${topAgent.user.photoUrl}"/>
                </a>
                <div>
                    <a th:href="${topAgent.publicUrl}" th:title="${topAgent.user.displayName}">
                        <h2 th:text="${topAgent.user.displayName}">AGENT</h2>
                        <div th:text="${topAgent.user.employer}">EMPLOYER</div>
                    </a>
                </div>
            </div>

            <a class="btn btn-primary" id="btn-send-message" target="_blank"
               th:href="'/whatsapp/neighbourhoods/' + ${neighbourhood.id} + '?agent-id='+ ${topAgent.id}">
                <i class="fa-brands fa-whatsapp"></i>
                <span th:text="#{button.send_message}"> Send Message</span>
            </a>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const json = JSON.parse(/*[[${mapMarkersJson}]]*/ '');

    function on_map_ready(id, map) {
        console.log(json);

        for (var i = 0; i < json.length; i++) {
            let item = json[i];
            const icon = L.AwesomeMarkers.icon({
                icon: 'home',
                markerColor: item.sold ? 'gray' : '#1d7edf',
                prefix: 'fa'
            })

            let marker = L.marker([item.latitude, item.longitude], {icon: icon});
            marker.on('mouseover', () => {
                const html = `<div class="map-listing-card" id="map-listing-card-${item.id}">
                    <a href="${item.url}" target="_blank">
                        <div class="flex">
                            <div class="listing-image">
                                <img src="${item.heroImageUrl}" />
                            </div>
                            <div class="listing-details">
                                <b class="listing-price">${item.price}</b>
                                <div class="flex">
                                   <div>${item.bedrooms}</div>
                                   <div class="margin-left-small">${item.area}</div>
                                </div>
                                <div class="gray">${item.location}</div>
                                <div class="text-danger margin-top-small"><b>${item.status}</b></div>
                            </div>
                        </div>
                    </a>
                </div>`;
                marker.bindPopup(html);
                marker.openPopup();
            });
            map.addLayer(marker);
        }
    }

    document.addEventListener(
        'DOMContentLoaded',
        function () {
            const elt = document.getElementById('toast-message');
            if (elt) {
                const toast = new bootstrap.Toast(elt);
                toast.show();
            }
        },
        false
    );

</script>
</body>
</html>
