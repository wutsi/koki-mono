database:
    pool-size: 4

spring:
    datasource:
        driverClassName: com.mysql.cj.jdbc.Driver
        url: jdbc:mysql://localhost:3306/koki?serverTimezone=UTC&useSSL=false&allowPublicKeyRetrieval=true
        username: root
        password:
        hikari:
            connection-timeout: 30000
            connection-test-query: "SELECT 1"
            idle-timeout: 600000             # 10 mins
            initialization-fail-timeout: 60000
            leak-detection-threshold: 0
            max-lifetime: 1800000            # 30 mins
            maximum-pool-size: ${database.pool-size}
            data-source-properties:
                cachePrepStmts: true
                prepStmtCacheSize: 250
                prepStmtCacheSqlLimit: 2048
    flyway:
        clean-disabled: false
    jpa:
        show-sql: false
        hibernate:
            ddl-auto: none
            naming:
                physical-strategy: com.wutsi.koki.platform.util.CustomPhysicalNamingStrategy
        properties:
            hibernate:
                dialect: org.hibernate.dialect.MySQLDialect

    jackson:
        default-property-inclusion: non_null
        deserialization:
            FAIL_ON_UNKNOWN_PROPERTIES: false
            ACCEPT_EMPTY_STRING_AS_NULL_OBJECT: true
        mapper:
            ACCEPT_CASE_INSENSITIVE_ENUMS: true
            ACCEPT_CASE_INSENSITIVE_PROPERTIES: true
        parser:
            INCLUDE_SOURCE_IN_LOCATION: true

    mvc:
        pathmatch:
            matching-strategy: ANT_PATH_MATCHER
    servlet:
        multipart:
            max-file-size: 10240KB
            max-request-size: 10240KB

server:
    port: 8080
    compression:
        enabled: true
        mime-types: application/json,application/xml,text/html,text/xml,text/plain
        min-response-size: 512

springdoc:
    packages-to-scan: com.wutsi.koki
    show-actuator: true
    swagger-ui:
        path: /api.html
        operations-sorter: alpha
        tags-sorter: alpha
    group-configs:
        -   group: authentication
            display-name: Authentication API
            paths-to-match: /v1/auth, /v1/auth/*

        -   group: file
            display-name: File API
            paths-to-match: /v1/files, /v1/files/*

        -   group: forms
            display-name: Form API
            paths-to-match: /v1/forms, /v1/forms/*, /v1/forms/**, /v1/form-data, /v1/form-data/*

        -   group: messages
            display-name: Message API
            paths-to-match: /v1/messages, /v1/messages/*

        -   group: scripts
            display-name: Script API
            paths-to-match: /v1/scripts, /v1/scripts/**

        -   group: tenant
            display-name: Tenant API
            paths-to-match: /v1/tenants, /v1/tenants/**, /v1/configurations, /v1/configurations/**

        -   group: user
            display-name: User API
            paths-to-match: /v1/users, /v1/users/**, /v1/roles, /v1/roles/**

        -   group: workflow
            display-name: Workflow API
            paths-to-match: /v1/workflows, /v1/workflows/**

        -   group: workflow-engine
            display-name: Workflow Engine
            paths-to-match: /v1/workflow-instances, /v1/workflow-instances/**, /v1/activity-instances/**, /v1/logs, /v1/logs/**

management:
    endpoint:
        health:
            show-details: always
        info:
            git:
                mode: full
    endpoints:
        web:
            exposure:
                include: "beans,flyway,health,info,scheduledtasks,mappings"

logging:
    level:
        root: INFO
        com.amazonaws: ERROR
        com.icegreen.greenmail.smtp.SmtpManager: ERROR
        org.springframework: INFO
        org.hibernate: ERROR
        org.hibernate.engine.jdbc.spi.SqlExceptionHelper: OFF
        com.wutsi: DEBUG
        springfox: ERROR

    pattern:
        console: "%d Type=%level Logger=%c Thread=%thread %m%n"
        file: "%d Type=%level Logger=%c Thread=%thread %m%n"

koki:
    server-url: http://localhost:${server.port}
    portal-url: http://localhost:8081
    executor:
        thread-pool-size: 16
    rabbitmq:
        url: amqp://localhost
    event-publisher:
        type: rabbitmq # rabbitmq | spring
        rabbitmq:
            exchange-name: koki
            max-retries: 24
            ttl-seconds: 84600
    storage:
        type: local # local | s3
        local:
            directory: ${user.home}/__wutsi
            base-url: http://localhost:${server.port}
            servlet-path: /local-storage
    workflow-engine:
        rabbitmq:
            workflow-queue: koki-workflow-queue
            workflow-dlq: koki-workflow-dlq
            log-queue: koki-log-queue
            log-dlq: koki-log-dlq
            dlq-cron: "0 */30 * * * *"  # Every 30 mins
            consumer-delay-seconds: 1
